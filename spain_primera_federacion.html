<!-- PRIMERA FEDERACIÃ“N WIDGET - SPAIN 3RD TIER -->
<div id="esn-pf-container">

    <!-- 1. HEADER -->
    <div class="esn-pf-header">
        <div>
            <h2 style="color: #004b93; margin: 0; text-transform: uppercase; letter-spacing: 1px;">Primera FederaciÃ³n
            </h2>
            <span style="color: #666; font-size: 14px;">Spain â€¢ 2024/2025 Season</span>
        </div>
        <div class="esn-stats-summary">
            <div class="esn-stat-pill">
                <i class="fas fa-video"></i>
                <span id="total-videos-count">0</span> Videos
            </div>
            <div class="esn-stat-pill">
                <i class="fas fa-futbol"></i>
                <span id="teams-with-videos-count">0</span>/40 Teams
            </div>
        </div>
    </div>

    <!-- 2. MAIN LAYOUT -->
    <div class="esn-pf-body">

        <!-- SIDEBAR (Team List with Video Counts) -->
        <div class="esn-pf-sidebar">
            <input type="text" id="esn-team-search" placeholder="ðŸ” Search Team or Group..."
                onkeyup="window.filterTeams()">

            <!-- Quick Filters -->
            <div class="esn-filter-bar">
                <button class="esn-filter-btn active" onclick="window.filterByGroup('all')">All</button>
                <button class="esn-filter-btn" onclick="window.filterByGroup('G1')">Group 1</button>
                <button class="esn-filter-btn" onclick="window.filterByGroup('G2')">Group 2</button>
            </div>

            <div id="esn-team-list">
                <!-- Teams load here -->
            </div>
        </div>

        <!-- CONTENT (Video Area) -->
        <div class="esn-pf-content">
            <h1 id="esn-selected-title">Select a Team</h1>

            <div class="esn-tabs">
                <button class="esn-tab-btn active" onclick="window.switchTab('fullMatches')">
                    <i class="fas fa-film"></i> Full Matches <span class="tab-count" id="full-count">0</span>
                </button>
                <button class="esn-tab-btn" onclick="window.switchTab('highlights')">
                    <i class="fas fa-star"></i> Highlights <span class="tab-count" id="highlights-count">0</span>
                </button>
                <button class="esn-tab-btn" onclick="window.switchTab('academy')">
                    <i class="fas fa-users"></i> Youth/Base <span class="tab-count" id="academy-count">0</span>
                </button>
            </div>

            <div id="esn-video-grid">
                <p style="color: #555; margin-top: 20px;">Select a team from the left to view matches.</p>
            </div>
        </div>

    </div>

    <!-- 3. POPUP VIDEO PLAYER (FULL WINDOW MODE) -->
    <div id="esn-player-modal" class="esn-modal">
        <div class="esn-modal-content">
            <div class="esn-modal-header">
                <span id="esn-playing-title" style="color:#004b93; font-weight:bold; font-size: 18px;">Match
                    Title</span>
                <span class="esn-close-btn" onclick="window.closeVideo()">âœ• Close</span>
            </div>
            <div class="esn-video-wrapper">
                <iframe id="esn-main-iframe" src="" frameborder="0"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                    allowfullscreen>
                </iframe>
            </div>
        </div>
    </div>

</div>

<!-- CSS STYLES (Primera Fed Theme - Royal Blue/Gold) -->
<style>
    /* Font Awesome for icons */
    @import url('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css');

    /* GLOBAL CONTAINER */
    #esn-pf-container {
        font-family: 'Oswald', 'Inter', sans-serif;
        background: #f4f6f9;
        color: #001a33;
        width: 100%;
        min-height: 700px;
        border: 1px solid #d1d9e6;
        display: flex;
        flex-direction: column;
        position: relative;
        box-sizing: border-box;
    }

    /* HEADER & STATS */
    .esn-pf-header {
        padding: 20px 25px;
        border-bottom: 5px solid #004b93;
        background: #fff;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
    }

    .esn-stats-summary {
        display: flex;
        gap: 12px;
    }

    .esn-stat-pill {
        background: #e6f0ff;
        padding: 8px 14px;
        border-radius: 4px;
        border: 1px solid #b3d1ff;
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 12px;
        color: #004b93;
        font-weight: 700;
        text-transform: uppercase;
    }

    .esn-stat-pill i {
        font-size: 13px;
    }

    .esn-pf-body {
        display: flex;
        flex: 1;
        height: 650px;
    }

    /* SIDEBAR */
    .esn-pf-sidebar {
        width: 30%;
        min-width: 280px;
        background: #fff;
        border-right: 1px solid #ddd;
        display: flex;
        flex-direction: column;
    }

    #esn-team-search {
        background: #fcfcfc;
        border: none;
        border-bottom: 1px solid #eee;
        color: #333;
        padding: 16px;
        width: 100%;
        box-sizing: border-box;
        font-size: 14px;
        outline: none;
    }

    /* FILTER BAR */
    .esn-filter-bar {
        display: flex;
        gap: 2px;
        padding: 5px;
        background: #004b93;
    }

    .esn-filter-btn {
        flex: 1;
        background: transparent;
        border: none;
        color: #fff;
        padding: 6px;
        font-size: 10px;
        font-weight: 700;
        text-transform: uppercase;
        cursor: pointer;
        border-radius: 2px;
        transition: 0.2s;
        opacity: 0.6;
    }

    .esn-filter-btn:hover {
        opacity: 0.9;
    }

    .esn-filter-btn.active {
        background: rgba(255, 255, 255, 0.2);
        opacity: 1;
        box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    #esn-team-list {
        overflow-y: auto;
        flex: 1;
        background: #fff;
    }

    /* TEAM ITEMS */
    .esn-team-item {
        padding: 14px 20px;
        border-bottom: 1px solid #f9f9f9;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 13px;
        color: #333;
        transition: 0.2s;
    }

    .esn-team-item:hover {
        background: #f5f8ff;
        color: #004b93;
    }

    .esn-team-item.active {
        background: #e6f0ff;
        border-left: 6px solid #004b93;
        color: #004b93;
        font-weight: 700;
    }

    .esn-team-info {
        display: flex;
        flex-direction: column;
    }

    .esn-team-group {
        font-size: 9px;
        color: #999;
        text-transform: uppercase;
        font-weight: 700;
        margin-top: 2px;
    }

    .esn-video-badge {
        background: #f0f0f0;
        padding: 2px 8px;
        border-radius: 2px;
        font-size: 10px;
        font-weight: 800;
        color: #888;
        border: 1px solid #ddd;
    }

    .esn-team-item.active .esn-video-badge {
        background: #004b93;
        color: #fff;
        border-color: #004b93;
    }

    /* CONTENT AREA */
    .esn-pf-content {
        width: 70%;
        padding: 30px;
        background: #fdfdfd;
        overflow-y: auto;
    }

    #esn-selected-title {
        margin-top: 0;
        text-transform: uppercase;
        color: #004b93;
        font-size: 30px;
        font-weight: 900;
        padding-bottom: 15px;
        border-bottom: 2px solid #eee;
    }

    /* TABS */
    .esn-tabs {
        display: flex;
        gap: 20px;
        margin: 20px 0;
    }

    .esn-tab-btn {
        background: #f0f2f5;
        border: 1px solid #ddd;
        color: #666;
        padding: 10px 18px;
        cursor: pointer;
        font-weight: 700;
        font-size: 12px;
        border-radius: 4px;
        transition: 0.2s;
        display: flex;
        align-items: center;
        gap: 8px;
        text-transform: uppercase;
    }

    .esn-tab-btn.active {
        background: #004b93;
        color: #fff;
        border-color: #004b93;
    }

    /* VIDEO CARDS */
    .esn-v-card {
        background: #fff;
        border: 1px solid #e1e8f0;
        border-radius: 4px;
        margin-bottom: 12px;
        padding: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer;
        transition: 0.2s;
    }

    .esn-v-card:hover {
        border-color: #004b93;
        box-shadow: 0 4px 12px rgba(0, 75, 147, 0.1);
        transform: scale(1.01);
    }

    .esn-v-info h4 {
        margin: 0 0 4px 0;
        color: #001a33;
        font-size: 16px;
    }

    .esn-v-info span {
        color: #888;
        font-size: 12px;
        font-weight: 500;
    }

    .esn-v-play {
        color: #004b93;
        font-size: 22px;
    }

    /* MODAL */
    .esn-modal {
        display: none;
        position: fixed;
        z-index: 99999;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
    }

    .esn-modal-content {
        display: flex;
        flex-direction: column;
        height: 100%;
    }

    .esn-modal-header {
        padding: 15px 25px;
        background: #fff;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .esn-close-btn {
        cursor: pointer;
        color: #333;
        font-weight: 900;
        background: #eee;
        padding: 6px 12px;
        border-radius: 4px;
    }

    .esn-video-wrapper {
        flex: 1;
        position: relative;
    }

    .esn-video-wrapper iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
    }

    @media (max-width: 900px) {
        .esn-pf-body {
            flex-direction: column;
            height: auto;
        }

        .esn-pf-sidebar {
            width: 100%;
            max-height: 400px;
        }

        .esn-pf-content {
            width: 100%;
        }
    }
</style>

<!-- JAVASCRIPT LOGIC -->
<script>
    (function () {

        // ==========================================
        // 1. DATABASE - PRIMERA FEDERACIÃ“N TEAMS
        // ==========================================
        const db = {
            "ad ceuta fc": {
                group: "G2",
                fullMatches: [
                    { title: "vs Recreativo de Huelva", date: "15 September 2024", link: "https://player.mux.com/HlRUZKJsqYlEHBe6ThLIMMTn98V01CXbXAb5qDoQzXl00" },
                    { title: "vs Algeciras CF", date: "01 September 2024", link: "https://player.mux.com/CpQwnibKZEWfQWkFdaml27nUoMxwbLIHDOPXp01QRjKA" },
                ],
                highlights: [
                    { title: "Season Start Roundup", date: "Highlights", link: "https://player.mux.com/1HFe2t6PWeEpjjukQUQvqFHKXCn5iKPgFJtDrt8hGT8" },
                ],
                academy: []
            },
            "algeciras cf": {
                group: "G2",
                fullMatches: [
                    { title: "vs AD Ceuta FC", date: "01 September 2024", link: "https://player.mux.com/CpQwnibKZEWfQWkFdaml27nUoMxwbLIHDOPXp01QRjKA" },
                ],
                highlights: [],
                academy: []
            },
            "recreativo de huelva": {
                group: "G2",
                fullMatches: [
                    { title: "vs AD Ceuta FC", date: "15 September 2024", link: "https://player.mux.com/HlRUZKJsqYlEHBe6ThLIMMTn98V01CXbXAb5qDoQzXl00" },
                ],
                highlights: [],
                academy: []
            },
            "hercules cf": { group: "G2", fullMatches: [], highlights: [], academy: [] },
            "ud ibiza": { group: "G2", fullMatches: [], highlights: [], academy: [] },
            "marbella fc": { group: "G2", fullMatches: [], highlights: [], academy: [] },
            "real murcia cf": { group: "G2", fullMatches: [], highlights: [], academy: [] },
            "ad alcorcon": { group: "G2", fullMatches: [], highlights: [], academy: [] },
            "real madrid castilla": { group: "G2", fullMatches: [], highlights: [], academy: [] },
            "atletico madrid b": { group: "G2", fullMatches: [], highlights: [], academy: [] },
            "betis deportivo": { group: "G2", fullMatches: [], highlights: [], academy: [] },
            "villarreal cf b": { group: "G2", fullMatches: [], highlights: [], academy: [] },
            "sevilla atletico": { group: "G2", fullMatches: [], highlights: [], academy: [] },
            "cultural leonesa": { group: "G1", fullMatches: [], highlights: [], academy: [] },
            "ponferradina": { group: "G1", fullMatches: [], highlights: [], academy: [] },
            "gimnastic de tarragona": { group: "G1", fullMatches: [], highlights: [], academy: [] },
            "barcelona atletic": { group: "G1", fullMatches: [], highlights: [], academy: [] },
            "andorra": { group: "G1", fullMatches: [], highlights: [], academy: [] },
            "lugo": { group: "G1", fullMatches: [], highlights: [], academy: [] },
            "zamora cf": { group: "G1", fullMatches: [], highlights: [], academy: [] }
        };

        // Add all 40 teams as placeholders for logic
        const g1 = [
            "Andorra", "Amorebieta", "Arenteiro", "Barakaldo", "Barcelona AtlÃ¨tic",
            "Bilbao Athletic", "Celta Fortuna", "Cultural Leonesa", "GimnÃ stic",
            "Lugo", "Osasuna B", "Ourense", "Ponferradina", "Real Sociedad B",
            "Real UniÃ³n", "Segoviana", "Sestao River", "Tarazona",
            "Unionistas de Salamanca", "Zamora"
        ];
        const g2 = [
            "AD AlcorcÃ³n", "AD Ceuta FC", "AD MÃ©rida", "Algeciras CF", "Antequera CF",
            "AtlÃ©tico Madrid B", "AtlÃ©tico SanluqueÃ±o", "Betis Deportivo",
            "CF Intercity", "CD Alcoyano", "CF Fuenlabrada", "HÃ©rcules CF",
            "Marbella FC", "Real Madrid Castilla", "Real Murcia CF",
            "Recreativo de Huelva", "Sevilla AtlÃ©tico", "UD Ibiza",
            "Villarreal CF B", "Yeclano Deportivo"
        ];

        // Combine and mark groups
        const allFullTeams = [];
        g1.forEach(t => allFullTeams.push({ name: t, group: "G1" }));
        g2.forEach(t => allFullTeams.push({ name: t, group: "G2" }));
        allFullTeams.sort((a, b) => a.name.localeCompare(b.name));

        // ==========================================
        // 2. LOGIC
        // ==========================================

        let currentTeamKey = null;
        let currentTab = 'fullMatches';
        let currentGroupFilter = 'all';

        function getVideoCount(name) {
            const key = name.toLowerCase();
            if (!db[key]) return 0;
            return (db[key].fullMatches?.length || 0) + (db[key].highlights?.length || 0) + (db[key].academy?.length || 0);
        }

        function updateStats() {
            let total = 0; let withVid = 0;
            allFullTeams.forEach(t => {
                const c = getVideoCount(t.name);
                total += c;
                if (c > 0) withVid++;
            });
            document.getElementById('total-videos-count').innerText = total;
            document.getElementById('teams-with-videos-count').innerText = withVid;
        }

        window.filterByGroup = function (g) {
            currentGroupFilter = g;
            document.querySelectorAll('.esn-filter-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            window.filterTeams();
        };

        window.filterTeams = function () {
            const term = document.getElementById('esn-team-search').value.toLowerCase();
            document.querySelectorAll('.esn-team-item').forEach(item => {
                const name = item.querySelector('strong').innerText.toLowerCase();
                const group = item.getAttribute('data-group');
                const matchesSearch = name.includes(term);
                const matchesGroup = (currentGroupFilter === 'all' || currentGroupFilter === group);
                item.style.display = (matchesSearch && matchesGroup) ? 'flex' : 'none';
            });
        };

        window.selectTeam = function (name, el) {
            currentTeamKey = name.toLowerCase();
            document.getElementById('esn-selected-title').innerText = name;
            document.querySelectorAll('.esn-team-item').forEach(i => i.classList.remove('active'));
            if (el) el.classList.add('active');

            const data = db[currentTeamKey] || { fullMatches: [], highlights: [], academy: [] };
            document.getElementById('full-count').innerText = data.fullMatches.length;
            document.getElementById('highlights-count').innerText = data.highlights.length;
            document.getElementById('academy-count').innerText = data.academy.length;
            window.switchTab('fullMatches');
        };

        window.switchTab = function (t) {
            currentTab = t;
            document.querySelectorAll('.esn-tab-btn').forEach(b => b.classList.remove('active'));
            if (t === 'fullMatches') document.querySelectorAll('.esn-tab-btn')[0].classList.add('active');
            if (t === 'highlights') document.querySelectorAll('.esn-tab-btn')[1].classList.add('active');
            if (t === 'academy') document.querySelectorAll('.esn-tab-btn')[2].classList.add('active');
            renderVideos();
        };

        function renderVideos() {
            const grid = document.getElementById('esn-video-grid');
            grid.innerHTML = "";
            const vids = (db[currentTeamKey] && db[currentTeamKey][currentTab]) || [];
            if (vids.length === 0) {
                grid.innerHTML = '<p style="color:#999; text-align:center; padding:50px;">No content found for this category.</p>';
                return;
            }
            vids.forEach(v => {
                const div = document.createElement('div');
                div.className = 'esn-v-card';
                div.onclick = () => window.playVideo(v.link, v.title);
                div.innerHTML = `
                <div class="esn-v-info"><h4>${v.title}</h4><span>${v.date}</span></div>
                <div class="esn-v-play">â–¶</div>
            `;
                grid.appendChild(div);
            });
        }

        window.playVideo = function (u, t) {
            document.getElementById('esn-playing-title').innerText = t;
            document.getElementById('esn-main-iframe').src = u;
            document.getElementById('esn-player-modal').style.display = 'block';
        };

        window.closeVideo = function () {
            document.getElementById('esn-player-modal').style.display = 'none';
            document.getElementById('esn-main-iframe').src = "";
        };

        // INIT
        setTimeout(() => {
            const list = document.getElementById('esn-team-list');
            allFullTeams.forEach(t => {
                const div = document.createElement('div');
                div.className = 'esn-team-item';
                div.setAttribute('data-group', t.group);
                const count = getVideoCount(t.name);
                div.innerHTML = `
                <div class="esn-team-info"><strong>${t.name}</strong><span class="esn-team-group">${t.group === 'G1' ? 'Group 1 (North)' : 'Group 2 (South)'}</span></div>
                <span class="esn-video-badge">${count}</span>
            `;
                div.onclick = function () { window.selectTeam(t.name, this); };
                list.appendChild(div);
            });
            updateStats();
        }, 100);

    })();
</script>