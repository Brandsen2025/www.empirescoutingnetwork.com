<!-- KEUKEN KAMPIOEN DIVISIE WIDGET - NETHERLANDS 2ND TIER -->
<div id="esn-kkd-container">

    <!-- 1. HEADER -->
    <div class="esn-kkd-header">
        <div>
            <h2 style="color: #F5821F; margin: 0; text-transform: uppercase; letter-spacing: 1px;">Keuken Kampioen
                Divisie</h2>
            <span style="color: #ccc; font-size: 14px;">Netherlands â€¢ 2025/2026 Season</span>
        </div>
        <div class="esn-stats-summary">
            <div class="esn-stat-pill">
                <i class="fas fa-video"></i>
                <span id="total-videos-count">0</span> Videos
            </div>
            <div class="esn-stat-pill">
                <i class="fas fa-futbol"></i>
                <span id="teams-with-videos-count">0</span>/20 Teams
            </div>
        </div>
    </div>

    <!-- 2. MAIN LAYOUT -->
    <div class="esn-kkd-body">

        <!-- SIDEBAR (Team List with Video Counts) -->
        <div class="esn-kkd-sidebar">
            <input type="text" id="esn-team-search" placeholder="ðŸ” Search Team..." onkeyup="window.filterTeams()">

            <!-- Quick Filters -->
            <div class="esn-filter-bar">
                <button class="esn-filter-btn active" onclick="window.filterByVideoCount('all')">All Teams</button>
                <button class="esn-filter-btn" onclick="window.filterByVideoCount('withVideos')">With Videos</button>
                <button class="esn-filter-btn" onclick="window.filterByVideoCount('noVideos')">No Videos</button>
            </div>

            <div id="esn-team-list">
                <!-- Teams load here -->
            </div>
        </div>

        <!-- CONTENT (Video Area) -->
        <div class="esn-kkd-content">
            <h1 id="esn-selected-title">Select a Team</h1>

            <div class="esn-tabs">
                <button class="esn-tab-btn active" onclick="window.switchTab('fullMatches')">
                    <i class="fas fa-film"></i> Full Matches <span class="tab-count" id="full-count">0</span>
                </button>
                <button class="esn-tab-btn" onclick="window.switchTab('highlights')">
                    <i class="fas fa-star"></i> Highlights <span class="tab-count" id="highlights-count">0</span>
                </button>
                <button class="esn-tab-btn" onclick="window.switchTab('academy')">
                    <i class="fas fa-users"></i> Academy/Jong <span class="tab-count" id="academy-count">0</span>
                </button>
            </div>

            <div id="esn-video-grid">
                <p style="color: #777; margin-top: 20px;">Select a team from the left to view matches.</p>
            </div>
        </div>

    </div>

    <!-- 3. POPUP VIDEO PLAYER (FULL WINDOW MODE) -->
    <div id="esn-player-modal" class="esn-modal">
        <div class="esn-modal-content">
            <div class="esn-modal-header">
                <span id="esn-playing-title" style="color:#F5821F; font-weight:bold; font-size: 18px;">Match
                    Title</span>
                <span class="esn-close-btn" onclick="window.closeVideo()">âœ• Close</span>
            </div>
            <div class="esn-video-wrapper">
                <iframe id="esn-main-iframe" src="" frameborder="0"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                    allowfullscreen>
                </iframe>
            </div>
        </div>
    </div>

</div>

<!-- CSS STYLES (KKD Theme - Dark Blue/Orange) -->
<style>
    /* Font Awesome for icons */
    @import url('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css');

    /* GLOBAL CONTAINER */
    #esn-kkd-container {
        font-family: 'Montserrat', sans-serif;
        background: #182C4F;
        /* KKD Dark Blue */
        color: #fff;
        width: 100%;
        min-height: 700px;
        border: 1px solid #333;
        display: flex;
        flex-direction: column;
        position: relative;
        box-sizing: border-box;
    }

    /* HEADER & STATS */
    .esn-kkd-header {
        padding: 25px;
        border-bottom: 4px solid #F5821F;
        background: #111f38;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
    }

    .esn-stats-summary {
        display: flex;
        gap: 15px;
    }

    .esn-stat-pill {
        background: #203a66;
        padding: 8px 16px;
        border-radius: 20px;
        border: 1px solid #2d5291;
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 13px;
        color: #F5821F;
    }

    .esn-stat-pill i {
        font-size: 14px;
    }

    .esn-stat-pill span {
        font-weight: bold;
    }

    .esn-kkd-body {
        display: flex;
        flex: 1;
        height: 650px;
    }

    /* SIDEBAR */
    .esn-kkd-sidebar {
        width: 28%;
        min-width: 250px;
        background: #142442;
        border-right: 1px solid #2d5291;
        display: flex;
        flex-direction: column;
    }

    #esn-team-search {
        background: #182C4F;
        border: none;
        border-bottom: 1px solid #2d5291;
        color: #fff;
        padding: 15px;
        width: 100%;
        box-sizing: border-box;
        font-size: 14px;
    }

    #esn-team-search:focus {
        outline: 1px solid #F5821F;
    }

    /* FILTER BAR */
    .esn-filter-bar {
        display: flex;
        gap: 5px;
        padding: 10px;
        background: #111f38;
        border-bottom: 1px solid #222;
    }

    .esn-filter-btn {
        flex: 1;
        background: #203a66;
        border: 1px solid #2d5291;
        color: #aaa;
        padding: 8px 10px;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        cursor: pointer;
        border-radius: 4px;
        transition: all 0.2s;
    }

    .esn-filter-btn:hover {
        background: #2d5291;
        color: #F5821F;
    }

    .esn-filter-btn.active {
        background: #F5821F;
        color: #fff;
        border-color: #F5821F;
    }

    #esn-team-list {
        overflow-y: auto;
        flex: 1;
    }

    /* TEAM ITEMS WITH VIDEO COUNTS */
    .esn-team-item {
        padding: 15px 20px;
        border-bottom: 1px solid #222;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: #ccc;
        transition: 0.2s;
    }

    .esn-team-item:hover {
        background: #203a66;
        color: #F5821F;
    }

    .esn-team-item.active {
        background: #203a66;
        border-left: 4px solid #F5821F;
        color: #F5821F;
        font-weight: bold;
    }

    .esn-team-name {
        flex: 1;
    }

    .esn-video-badge {
        background: #182C4F;
        padding: 4px 10px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: bold;
        color: #666;
        border: 1px solid #2d5291;
        min-width: 35px;
        text-align: center;
    }

    .esn-team-item:hover .esn-video-badge {
        border-color: #F5821F;
        color: #F5821F;
    }

    .esn-team-item.active .esn-video-badge {
        background: #F5821F;
        color: #fff;
        border-color: #F5821F;
    }

    .esn-video-badge.has-videos {
        color: #F5821F;
        border-color: #F5821F;
        background: #203a66;
    }

    .esn-video-badge.no-videos {
        color: #555;
        border-color: #333;
    }

    /* CONTENT AREA */
    .esn-kkd-content {
        width: 72%;
        padding: 30px;
        background: #182C4F;
        overflow-y: auto;
    }

    #esn-selected-title {
        margin-top: 0;
        text-transform: uppercase;
        color: #fff;
        font-size: 28px;
    }

    /* TABS WITH COUNTS */
    .esn-tabs {
        display: flex;
        gap: 20px;
        margin-bottom: 25px;
        border-bottom: 1px solid #2d5291;
    }

    .esn-tab-btn {
        background: none;
        border: none;
        color: #888;
        padding: 12px 15px;
        cursor: pointer;
        font-weight: bold;
        font-size: 14px;
        border-bottom: 3px solid transparent;
        transition: 0.3s;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .esn-tab-btn:hover {
        color: #F5821F;
    }

    .esn-tab-btn.active {
        color: #F5821F;
        border-bottom: 3px solid #F5821F;
    }

    .tab-count {
        background: #203a66;
        padding: 2px 8px;
        border-radius: 10px;
        font-size: 11px;
        font-weight: bold;
        border: 1px solid #2d5291;
        color: #aaa;
    }

    .esn-tab-btn.active .tab-count {
        background: #F5821F;
        color: #fff;
        border-color: #F5821F;
    }

    /* VIDEO CARDS */
    .esn-v-card {
        background: #203a66;
        border: 1px solid #2d5291;
        border-radius: 6px;
        margin-bottom: 12px;
        padding: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer;
        transition: all 0.2s ease;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .esn-v-card:hover {
        border-color: #F5821F;
        transform: translateX(8px);
        background: #2d5291;
        box-shadow: 0 4px 8px rgba(245, 130, 31, 0.1);
    }

    .esn-v-info h4 {
        margin: 0 0 6px 0;
        color: #fff;
        font-size: 16px;
    }

    .esn-v-info span {
        color: #aaa;
        font-size: 13px;
    }

    .esn-v-play {
        color: #F5821F;
        font-size: 24px;
    }

    /* FULL SCREEN MODAL STYLES */
    .esn-modal {
        display: none;
        position: fixed;
        z-index: 2147483647;
        left: 0;
        top: 0;
        width: 100vw;
        height: 100vh;
        background-color: rgba(0, 0, 0, 0.9);
    }

    .esn-modal-content {
        width: 100%;
        height: 100%;
        margin: 0;
        background: #000;
        display: flex;
        flex-direction: column;
        border: none;
    }

    .esn-modal-header {
        flex-shrink: 0;
        padding: 15px 25px;
        background: #111f38;
        border-bottom: 1px solid #222;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .esn-close-btn {
        cursor: pointer;
        color: #ccc;
        font-size: 18px;
        padding: 5px 15px;
        background: #203a66;
        border-radius: 4px;
        transition: 0.2s;
    }

    .esn-close-btn:hover {
        background: #F5821F;
        color: #fff;
    }

    .esn-video-wrapper {
        flex-grow: 1;
        width: 100%;
        position: relative;
        background: #000;
    }

    .esn-video-wrapper iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: none;
    }

    /* RESPONSIVE */
    @media (max-width: 900px) {
        .esn-kkd-body {
            flex-direction: column;
            height: auto;
        }

        .esn-kkd-sidebar {
            width: 100%;
            max-height: 300px;
        }

        .esn-kkd-content {
            width: 100%;
        }
    }
</style>

<!-- JAVASCRIPT LOGIC -->
<script>
    (function () {

        // ==========================================
        // 1. DATABASE - KEUKEN KAMPIOEN DIVISIE TEAMS
        // ==========================================
        const db = {
            "vitesse": {
                fullMatches: [
                    { title: "vs De Graafschap", date: "22 September 2025", link: "https://player.mux.com/HlRUZKJsqYlEHBe6ThLIMMTn98V01CXbXAb5qDoQzXl00" },
                ],
                highlights: [],
                academy: []
            },
            "volendam": {
                fullMatches: [
                    { title: "vs Excelsior", date: "18 August 2025", link: "https://player.mux.com/CpQwnibKZEWfQWkFdaml27nUoMxwbLIHDOPXp01QRjKA" },
                ],
                highlights: [],
                academy: []
            },
            "excelsior": {
                fullMatches: [
                    { title: "vs Volendam", date: "18 August 2025", link: "https://player.mux.com/CpQwnibKZEWfQWkFdaml27nUoMxwbLIHDOPXp01QRjKA" },
                ],
                highlights: [],
                academy: []
            },
            "ado den haag": {
                fullMatches: [
                    { title: "vs Roda JC", date: "25 August 2025", link: "https://player.mux.com/5OurPijDA8c600xk7tDQlcfHuCTiaui8onAzd2Zb00xfQ" },
                ],
                highlights: [],
                academy: []
            },
            "roda jc": {
                fullMatches: [
                    { title: "vs ADO Den Haag", date: "25 August 2025", link: "https://player.mux.com/5OurPijDA8c600xk7tDQlcfHuCTiaui8onAzd2Zb00xfQ" },
                ],
                highlights: [],
                academy: []
            },
            "dordrecht": {
                fullMatches: [
                    { title: "vs Emmen", date: "1 September 2025", link: "https://player.mux.com/joySVKHfLihFy02PTL56mw351wVAZag2XXo3F46OWD4s" },
                ],
                highlights: [],
                academy: []
            },
            "de graafschap": {
                fullMatches: [
                    { title: "vs Vitesse", date: "22 September 2025", link: "https://player.mux.com/HlRUZKJsqYlEHBe6ThLIMMTn98V01CXbXAb5qDoQzXl00" },
                ],
                highlights: [],
                academy: []
            },
            "emmen": {
                fullMatches: [
                    { title: "vs Dordrecht", date: "1 September 2025", link: "https://player.mux.com/joySVKHfLihFy02PTL56mw351wVAZag2XXo3F46OWD4s" },
                ],
                highlights: [],
                academy: []
            },
            "cambuur": {
                fullMatches: [],
                highlights: [],
                academy: []
            },
            "vvv-venlo": {
                fullMatches: [],
                highlights: [],
                academy: []
            },
            "mvv": {
                fullMatches: [],
                highlights: [],
                academy: []
            },
            "helmond sport": {
                fullMatches: [],
                highlights: [],
                academy: []
            },
            "telstar": {
                fullMatches: [],
                highlights: [],
                academy: []
            },
            "top oss": {
                fullMatches: [],
                highlights: [],
                academy: []
            },
            "den bosch": {
                fullMatches: [],
                highlights: [],
                academy: []
            },
            "eindhoven": {
                fullMatches: [],
                highlights: [],
                academy: []
            },
            "jong ajax": {
                fullMatches: [],
                highlights: [],
                academy: []
            },
            "jong psv": {
                fullMatches: [],
                highlights: [],
                academy: []
            },
            "jong az": {
                fullMatches: [],
                highlights: [],
                academy: []
            },
            "jong utrecht": {
                fullMatches: [],
                highlights: [],
                academy: []
            }
        };

        const allTeams = [
            "ADO Den Haag", "Cambuur", "De Graafschap", "Den Bosch", "Dordrecht",
            "Eindhoven", "Emmen", "Excelsior", "Helmond Sport", "Jong Ajax",
            "Jong AZ", "Jong PSV", "Jong Utrecht", "MVV", "Roda JC",
            "Telstar", "TOP Oss", "Vitesse", "Volendam", "VVV-Venlo"
        ].sort();

        // ==========================================
        // 2. VIDEO COUNT CALCULATION
        // ==========================================

        function getVideoCount(teamKey) {
            if (!db[teamKey]) return 0;
            return (db[teamKey].fullMatches?.length || 0) +
                (db[teamKey].highlights?.length || 0) +
                (db[teamKey].academy?.length || 0);
        }

        function updateGlobalStats() {
            let totalVideos = 0;
            let teamsWithVideos = 0;

            Object.keys(db).forEach(key => {
                const count = getVideoCount(key);
                totalVideos += count;
                if (count > 0) teamsWithVideos++;
            });

            document.getElementById('total-videos-count').textContent = totalVideos;
            document.getElementById('teams-with-videos-count').textContent = teamsWithVideos;
        }

        // ==========================================
        // 3. TEAM LIST RENDERING WITH COUNTS
        // ==========================================

        let currentTeamKey = null;
        let currentTab = 'fullMatches';
        let currentFilter = 'all';

        setTimeout(function () {
            const list = document.getElementById('esn-team-list');
            if (!list) return;

            list.innerHTML = "";
            allTeams.forEach(t => {
                const key = t.toLowerCase();
                const videoCount = getVideoCount(key);

                let div = document.createElement('div');
                div.className = 'esn-team-item';
                div.setAttribute('data-video-count', videoCount);
                div.innerHTML = `
                <span class="esn-team-name">${t}</span>
                <span class="esn-video-badge ${videoCount > 0 ? 'has-videos' : 'no-videos'}">${videoCount}</span>
            `;
                div.onclick = function () { window.selectTeam(t, this); };
                list.appendChild(div);
            });

            updateGlobalStats();
        }, 500);

        window.selectTeam = function (name, el) {
            currentTeamKey = name.toLowerCase();
            document.getElementById('esn-selected-title').innerText = name;

            let items = document.querySelectorAll('.esn-team-item');
            items.forEach(i => i.classList.remove('active'));
            if (el) el.classList.add('active');

            // Update tab counts
            const teamData = db[currentTeamKey] || { fullMatches: [], highlights: [], academy: [] };
            document.getElementById('full-count').textContent = teamData.fullMatches?.length || 0;
            document.getElementById('highlights-count').textContent = teamData.highlights?.length || 0;
            document.getElementById('academy-count').textContent = teamData.academy?.length || 0;

            window.switchTab('fullMatches');
        };

        // ==========================================
        // 4. FILTER FUNCTIONS
        // ==========================================

        window.filterByVideoCount = function (type) {
            currentFilter = type;

            // Update button states
            document.querySelectorAll('.esn-filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Filter teams
            const items = document.querySelectorAll('.esn-team-item');
            items.forEach(item => {
                const count = parseInt(item.getAttribute('data-video-count'));

                if (type === 'all') {
                    item.style.display = 'flex';
                } else if (type === 'withVideos') {
                    item.style.display = count > 0 ? 'flex' : 'none';
                } else if (type === 'noVideos') {
                    item.style.display = count === 0 ? 'flex' : 'none';
                }
            });
        };

        window.filterTeams = function () {
            let term = document.getElementById('esn-team-search').value.toLowerCase();
            let items = document.querySelectorAll('.esn-team-item');

            items.forEach(item => {
                const teamName = item.querySelector('.esn-team-name').innerText.toLowerCase();
                const matchesSearch = teamName.includes(term);
                const count = parseInt(item.getAttribute('data-video-count'));

                let shouldShow = matchesSearch;

                // Apply current filter
                if (currentFilter === 'withVideos' && count === 0) shouldShow = false;
                if (currentFilter === 'noVideos' && count > 0) shouldShow = false;

                item.style.display = shouldShow ? 'flex' : 'none';
            });
        };

        // ==========================================
        // 5. TAB SWITCHING & VIDEO RENDERING
        // ==========================================

        window.switchTab = function (category) {
            currentTab = category;
            let tabs = document.querySelectorAll('.esn-tab-btn');
            tabs.forEach(t => t.classList.remove('active'));

            if (category === 'fullMatches') tabs[0].classList.add('active');
            if (category === 'highlights') tabs[1].classList.add('active');
            if (category === 'academy') tabs[2].classList.add('active');

            renderVideos();
        };

        function renderVideos() {
            const grid = document.getElementById('esn-video-grid');
            grid.innerHTML = "";

            if (!currentTeamKey || !db[currentTeamKey] || !db[currentTeamKey][currentTab] || db[currentTeamKey][currentTab].length === 0) {
                grid.innerHTML = '<p style="color:#666; text-align:center; padding:40px 0;">No videos available yet for this category.</p>';
                return;
            }

            db[currentTeamKey][currentTab].forEach(vid => {
                let card = document.createElement('div');
                card.className = 'esn-v-card';
                card.onclick = function () { window.playVideo(vid.link, vid.title); };
                card.innerHTML = `
                <div class="esn-v-info">
                    <h4>${vid.title}</h4>
                    <span>${vid.date}</span>
                </div>
                <div class="esn-v-play">â–¶</div>
            `;
                grid.appendChild(card);
            });
        }

        // ==========================================
        // 6. VIDEO PLAYER LOGIC (FULL SCREEN)
        // ==========================================

        window.playVideo = function (url, title) {
            const modal = document.getElementById('esn-player-modal');
            const iframe = document.getElementById('esn-main-iframe');
            const titleSpan = document.getElementById('esn-playing-title');

            titleSpan.innerText = title;

            // Auto-Convert YouTube links
            if (url.includes("youtube.com/watch?v=")) {
                url = url.replace("watch?v=", "embed/");
                if (url.includes("&")) url = url.split("&")[0];
            } else if (url.includes("youtu.be/")) {
                url = url.replace("youtu.be/", "youtube.com/embed/");
            }

            iframe.src = url;
            modal.style.display = "block";
        };

        window.closeVideo = function () {
            const modal = document.getElementById('esn-player-modal');
            const iframe = document.getElementById('esn-main-iframe');
            modal.style.display = "none";
            iframe.src = "";
        };

    })();
</script>